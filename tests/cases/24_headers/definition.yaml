openapi: "3.0.3" # Use older openAPI spec version due to a bug in Zally: https://github.com/zalando/zally/issues/1230
info:
  title: "24 Headers"
  description: |
    Headers have `Header` impls. See <https://github.com/coriolinus/openapi-gen/issues/24>.
  version: "0.1.0"

paths:
  "/natural-persons":
    parameters:
      - $ref: "#/components/parameters/X-FLOW-ID"
      - $ref: "#/components/parameters/X-REQUEST-ID"

    post:
      description: |
        Create a new natural person identification.

        An identification is a snapshot in time of the data available to identify a person.
      operationId: createNaturalPersonIdentification
      requestBody:
        required: true
        content:
          "application/json":
            schema:
              $ref: "#/components/schemas/NaturalPersonIdentification"
      responses:
        '201':
          description: identification for natural person was created
          headers:
            Location:
              $ref: "#/components/headers/Location"
          content:
            "application/json":
              schema:
                $ref: "#/components/schemas/NaturalPersonIdentification"
        default:
          $ref: "#/components/responses/Default"

components:
  parameters:
    X-FLOW-ID:
      name: X-FLOW-ID
      in: header
      description: |
        A custom header that traces a business flow; it is forwarded to downstream requests generated by this service.
      required: false
      schema:
        type: string
        format: uuid
        x-newtype:
          from: true
          into: true
      example: 83bbfd48-440f-4648-95a5-278b9d755730

    X-REQUEST-ID:
      name: X-REQUEST-ID
      in: header
      description: |
        A custom header that traces a particular request; it is forwarded to downstream requests generated by this service.
        It is first generated at the load balancer, and is not visible or relevant to client-facing applications.
      required: false
      schema:
        type: string
        format: uuid
        x-newtype:
          from: true
          into: true
      example: 35d23b57-f571-48c7-9cee-b42455143f94

  schemas:
    IdentificationId:
      description: an identifier for this particular identification process
      type: string
      format: uuid
      x-newtype:
        pub: true

    PersonId:
      description: the FINVIA PersonId for this individual
      type: string
      format: uuid
      x-newtype:
        pub: true

    NaturalPersonIdentification:
      type: object
      properties:
        id:
          readOnly: true
          allOf:
            - $ref: "#/components/schemas/IdentificationId"
        person_id:
          $ref: "#/components/schemas/PersonId"
      required:
        - person_id

  responses:
    Default:
      description: an error occurred; see status code and problem object for more information
      content:
        "application/problem+json":
          schema:
            "$ref": "https://opensource.zalando.com/restful-api-guidelines/models/problem-1.0.1.yaml#/Problem"

  headers:
    Location:
      schema:
        description: |
          The path at which the new resource can be found.

          This is absolute in that it starts with a `/`, and describes the complete path.
          It is relative in that it does not name the server, transport method, port, or other URL-specific data.
        type: string
        format: path
        x-newtype:
          pub: true
